{"version":3,"file":"custom-camera.js","sources":["custom-camera.vue","cGFnZXMvY3VzdG9tLWNhbWVyYS9jdXN0b20tY2FtZXJhLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"custom-camera-page\">\r\n    <!-- 相机组件 -->\r\n    <camera \r\n      class=\"camera-preview\"\r\n      :device-position=\"devicePosition\"\r\n      :flash=\"flashMode\"\r\n      :frame-size=\"frameSize\"\r\n      @error=\"onCameraError\"\r\n      @initdone=\"onCameraReady\"\r\n      @scancode=\"onScanCode\"\r\n    >\r\n      <!-- 相机表面覆盖层 -->\r\n      <cover-view class=\"camera-overlay\">\r\n        <!-- 顶部控制栏 -->\r\n        <cover-view class=\"top-controls\">\r\n          <cover-view class=\"control-btn\" @tap=\"goBack\">\r\n            <cover-image src=\"/static/icons/back.svg\" class=\"icon\"></cover-image>\r\n          </cover-view>\r\n          \r\n          <cover-view class=\"camera-title\">{{ documentInfo.name }}拍摄</cover-view>\r\n          \r\n          <cover-view class=\"control-btn\" @tap=\"toggleFlash\">\r\n            <cover-image \r\n              :src=\"flashMode === 'on' ? '/static/icons/flash-on.svg' : '/static/icons/flash-off.svg'\" \r\n              class=\"icon\"\r\n            ></cover-image>\r\n          </cover-view>\r\n        </cover-view>\r\n\r\n        <!-- 人像轮廓参考框 -->\r\n        <cover-view class=\"photo-guide-frame\">\r\n          <!-- 证件照参考框 -->\r\n          <cover-view class=\"id-photo-frame\">\r\n            <cover-view class=\"frame-border\"></cover-view>\r\n            \r\n            <!-- 人脸轮廓指引 -->\r\n            <cover-view class=\"face-guide\">\r\n              <cover-view class=\"face-outline\">\r\n                <!-- 头部轮廓 -->\r\n                <cover-view class=\"head-outline\"></cover-view>\r\n                <!-- 肩部轮廓 -->\r\n                <cover-view class=\"shoulder-outline\"></cover-view>\r\n              </cover-view>\r\n              \r\n              <!-- 对齐指引线 -->\r\n              <cover-view class=\"guide-lines\">\r\n                <cover-view class=\"horizontal-line top\"></cover-view>\r\n                <cover-view class=\"horizontal-line center\"></cover-view>\r\n                <cover-view class=\"horizontal-line bottom\"></cover-view>\r\n                <cover-view class=\"vertical-line left\"></cover-view>\r\n                <cover-view class=\"vertical-line right\"></cover-view>\r\n              </cover-view>\r\n            </cover-view>\r\n            \r\n            <!-- 拍摄提示文字 -->\r\n            <cover-view class=\"photo-tips\">\r\n              <cover-view class=\"tip-text\">请保持头部居中，面部清晰</cover-view>\r\n              <cover-view class=\"tip-text\">{{ documentInfo.specs.requirements }}</cover-view>\r\n            </cover-view>\r\n          </cover-view>\r\n        </cover-view>\r\n\r\n        <!-- 底部控制栏 -->\r\n        <cover-view class=\"bottom-controls\">\r\n          <!-- 相册按钮 -->\r\n          <cover-view class=\"album-btn\" @tap=\"openAlbum\">\r\n            <cover-image src=\"/static/icons/album.svg\" class=\"album-icon\"></cover-image>\r\n            <cover-view class=\"album-text\">相册</cover-view>\r\n          </cover-view>\r\n          \r\n          <!-- 拍照按钮 -->\r\n          <cover-view class=\"capture-btn-wrapper\">\r\n            <cover-view class=\"capture-btn\" @tap=\"takePhoto\">\r\n              <cover-view class=\"capture-inner\"></cover-view>\r\n            </cover-view>\r\n          </cover-view>\r\n          \r\n          <!-- 翻转相机按钮 -->\r\n          <cover-view class=\"flip-btn\" @tap=\"flipCamera\">\r\n            <cover-image src=\"/static/icons/flip-camera.svg\" class=\"flip-icon\"></cover-image>\r\n            <cover-view class=\"flip-text\">翻转</cover-view>\r\n          </cover-view>\r\n        </cover-view>\r\n\r\n        <!-- 拍摄设置面板 -->\r\n        <cover-view class=\"settings-panel\" v-if=\"showSettings\">\r\n          <cover-view class=\"settings-content\">\r\n            <cover-view class=\"setting-item\">\r\n              <cover-view class=\"setting-label\">画质</cover-view>\r\n              <cover-view class=\"setting-options\">\r\n                <cover-view \r\n                  class=\"option-btn\" \r\n                  :class=\"{ active: frameSize === 'medium' }\"\r\n                  @tap=\"setFrameSize('medium')\"\r\n                >\r\n                  标准\r\n                </cover-view>\r\n                <cover-view \r\n                  class=\"option-btn\" \r\n                  :class=\"{ active: frameSize === 'large' }\"\r\n                  @tap=\"setFrameSize('large')\"\r\n                >\r\n                  高清\r\n                </cover-view>\r\n              </cover-view>\r\n            </cover-view>\r\n          </cover-view>\r\n        </cover-view>\r\n\r\n        <!-- 设置按钮 -->\r\n        <cover-view class=\"settings-btn\" @tap=\"toggleSettings\">\r\n          <cover-image src=\"/static/icons/settings.svg\" class=\"settings-icon\"></cover-image>\r\n        </cover-view>\r\n      </cover-view>\r\n    </camera>\r\n\r\n    <!-- 拍摄成功预览 -->\r\n    <view class=\"photo-preview\" v-if=\"capturedImage\">\r\n      <image :src=\"capturedImage\" class=\"preview-image\" mode=\"aspectFit\"></image>\r\n      \r\n      <view class=\"preview-controls\">\r\n        <view class=\"preview-btn secondary\" @tap=\"retakePhoto\">\r\n          <text class=\"btn-text\">重新拍摄</text>\r\n        </view>\r\n        <view class=\"preview-btn primary\" @tap=\"confirmPhoto\">\r\n          <text class=\"btn-text\">确认使用</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'CustomCamera',\r\n  data() {\r\n    return {\r\n      devicePosition: 'back', // 'front' | 'back'\r\n      flashMode: 'off', // 'auto' | 'on' | 'off'\r\n      frameSize: 'large', // 'small' | 'medium' | 'large'\r\n      showSettings: false,\r\n      capturedImage: null,\r\n      documentInfo: {\r\n        name: '身份证',\r\n        specs: {\r\n          requirements: '免冠，照片可看见两耳轮廓和相当于男士喉结处的地方'\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    // 获取传递的文档信息\r\n    if (options.data) {\r\n      try {\r\n        this.documentInfo = JSON.parse(decodeURIComponent(options.data))\r\n      } catch (e) {\r\n        console.error('解析文档数据失败:', e)\r\n      }\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack()\r\n    },\r\n    \r\n    toggleFlash() {\r\n      const modes = ['off', 'on', 'auto']\r\n      const currentIndex = modes.indexOf(this.flashMode)\r\n      this.flashMode = modes[(currentIndex + 1) % modes.length]\r\n    },\r\n    \r\n    flipCamera() {\r\n      this.devicePosition = this.devicePosition === 'back' ? 'front' : 'back'\r\n    },\r\n    \r\n    toggleSettings() {\r\n      this.showSettings = !this.showSettings\r\n    },\r\n    \r\n    setFrameSize(size) {\r\n      this.frameSize = size\r\n      this.showSettings = false\r\n    },\r\n    \r\n    takePhoto() {\r\n      const ctx = uni.createCameraContext()\r\n      ctx.takePhoto({\r\n        quality: 'high',\r\n        success: (res) => {\r\n          this.capturedImage = res.tempImagePath\r\n          console.log('拍摄成功:', res.tempImagePath)\r\n          \r\n          // 提供触觉反馈\r\n          uni.vibrateShort()\r\n        },\r\n        fail: (err) => {\r\n          console.error('拍摄失败:', err)\r\n          uni.showToast({\r\n            title: '拍摄失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      })\r\n    },\r\n    \r\n    openAlbum() {\r\n      uni.chooseImage({\r\n        count: 1,\r\n        sizeType: ['original'],\r\n        sourceType: ['album'],\r\n        success: (res) => {\r\n          this.capturedImage = res.tempFilePaths[0]\r\n        }\r\n      })\r\n    },\r\n    \r\n    retakePhoto() {\r\n      this.capturedImage = null\r\n    },\r\n    \r\n    confirmPhoto() {\r\n      if (this.capturedImage) {\r\n        // 返回上一页并传递图片路径\r\n        const pages = getCurrentPages()\r\n        const prevPage = pages[pages.length - 2]\r\n        if (prevPage) {\r\n          prevPage.$vm.handlePhotoResult(this.capturedImage)\r\n        }\r\n        uni.navigateBack()\r\n      }\r\n    },\r\n    \r\n    onCameraError(e) {\r\n      console.error('相机错误:', e)\r\n      uni.showToast({\r\n        title: '相机启动失败',\r\n        icon: 'none'\r\n      })\r\n    },\r\n    \r\n    onCameraReady() {\r\n      console.log('相机准备就绪')\r\n    },\r\n    \r\n    onScanCode(e) {\r\n      // 如果需要二维码扫描功能\r\n      console.log('扫描到二维码:', e)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.custom-camera-page {\r\n  position: relative;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  background-color: #000;\r\n}\r\n\r\n.camera-preview {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.camera-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  z-index: 10;\r\n}\r\n\r\n/* 顶部控制栏 */\r\n.top-controls {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 120rpx;\r\n  background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 32rpx;\r\n  padding-top: var(--status-bar-height, 44rpx);\r\n}\r\n\r\n.control-btn {\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: rgba(0, 0, 0, 0.3);\r\n  border-radius: 50%;\r\n}\r\n\r\n.icon {\r\n  width: 48rpx;\r\n  height: 48rpx;\r\n}\r\n\r\n.camera-title {\r\n  color: white;\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n  text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n/* 人像轮廓参考框 */\r\n.photo-guide-frame {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 500rpx;\r\n  height: 650rpx;\r\n}\r\n\r\n.id-photo-frame {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.frame-border {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  border: 4rpx solid rgba(255, 255, 255, 0.8);\r\n  border-radius: 16rpx;\r\n  box-shadow: 0 0 0 2rpx rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.face-guide {\r\n  position: absolute;\r\n  top: 60rpx;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  width: 320rpx;\r\n  height: 400rpx;\r\n}\r\n\r\n.face-outline {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.head-outline {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  width: 240rpx;\r\n  height: 300rpx;\r\n  border: 2rpx dashed rgba(255, 255, 255, 0.6);\r\n  border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;\r\n}\r\n\r\n.shoulder-outline {\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  width: 300rpx;\r\n  height: 120rpx;\r\n  border: 2rpx dashed rgba(255, 255, 255, 0.6);\r\n  border-radius: 50% 50% 0 0;\r\n  border-bottom: none;\r\n}\r\n\r\n.guide-lines {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n}\r\n\r\n.horizontal-line {\r\n  position: absolute;\r\n  left: 0;\r\n  right: 0;\r\n  height: 1rpx;\r\n  background-color: rgba(255, 255, 255, 0.4);\r\n}\r\n\r\n.horizontal-line.top { top: 80rpx; }\r\n.horizontal-line.center { top: 50%; }\r\n.horizontal-line.bottom { bottom: 80rpx; }\r\n\r\n.vertical-line {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  width: 1rpx;\r\n  background-color: rgba(255, 255, 255, 0.4);\r\n}\r\n\r\n.vertical-line.left { left: 60rpx; }\r\n.vertical-line.right { right: 60rpx; }\r\n\r\n.photo-tips {\r\n  position: absolute;\r\n  bottom: -120rpx;\r\n  left: 0;\r\n  right: 0;\r\n  text-align: center;\r\n}\r\n\r\n.tip-text {\r\n  display: block;\r\n  color: rgba(255, 255, 255, 0.9);\r\n  font-size: 24rpx;\r\n  line-height: 1.4;\r\n  margin-bottom: 8rpx;\r\n  text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n/* 底部控制栏 */\r\n.bottom-controls {\r\n  position: absolute;\r\n  bottom: 60rpx;\r\n  left: 0;\r\n  right: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 80rpx;\r\n}\r\n\r\n.album-btn, .flip-btn {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n}\r\n\r\n.album-icon, .flip-icon {\r\n  width: 56rpx;\r\n  height: 56rpx;\r\n}\r\n\r\n.album-text, .flip-text {\r\n  color: white;\r\n  font-size: 24rpx;\r\n  text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n.capture-btn-wrapper {\r\n  position: relative;\r\n}\r\n\r\n.capture-btn {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  background-color: white;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.3);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.capture-btn:active {\r\n  transform: scale(0.95);\r\n}\r\n\r\n.capture-inner {\r\n  width: 100rpx;\r\n  height: 100rpx;\r\n  background-color: #6C5CE7;\r\n  border-radius: 50%;\r\n}\r\n\r\n/* 设置面板 */\r\n.settings-btn {\r\n  position: absolute;\r\n  right: 32rpx;\r\n  bottom: 240rpx;\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.settings-icon {\r\n  width: 48rpx;\r\n  height: 48rpx;\r\n}\r\n\r\n.settings-panel {\r\n  position: absolute;\r\n  right: 32rpx;\r\n  bottom: 340rpx;\r\n  background-color: rgba(0, 0, 0, 0.8);\r\n  border-radius: 16rpx;\r\n  padding: 32rpx;\r\n  min-width: 200rpx;\r\n}\r\n\r\n.settings-content {\r\n  color: white;\r\n}\r\n\r\n.setting-item {\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.setting-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.setting-label {\r\n  font-size: 28rpx;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.setting-options {\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n\r\n.option-btn {\r\n  padding: 12rpx 24rpx;\r\n  background-color: rgba(255, 255, 255, 0.2);\r\n  border-radius: 8rpx;\r\n  font-size: 24rpx;\r\n  text-align: center;\r\n}\r\n\r\n.option-btn.active {\r\n  background-color: #6C5CE7;\r\n}\r\n\r\n/* 预览页面 */\r\n.photo-preview {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: #000;\r\n  z-index: 20;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.preview-image {\r\n  flex: 1;\r\n  width: 100%;\r\n}\r\n\r\n.preview-controls {\r\n  padding: 32rpx;\r\n  display: flex;\r\n  gap: 24rpx;\r\n}\r\n\r\n.preview-btn {\r\n  flex: 1;\r\n  height: 88rpx;\r\n  border-radius: 44rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-weight: 500;\r\n}\r\n\r\n.preview-btn.secondary {\r\n  background-color: rgba(255, 255, 255, 0.2);\r\n  color: white;\r\n}\r\n\r\n.preview-btn.primary {\r\n  background-color: #6C5CE7;\r\n  color: white;\r\n}\r\n\r\n.btn-text {\r\n  font-size: 32rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/workspace/ClientWorkArea/证照小程序/miniapp/zfb-uniapp/pages/custom-camera/custom-camera.vue'\nmy.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AAsIA,MAAK,YAAU;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AACL,WAAO;AAAA,MACL,gBAAgB;AAAA;AAAA,MAChB,WAAW;AAAA;AAAA,MACX,WAAW;AAAA;AAAA,MACX,cAAc;AAAA,MACd,eAAe;AAAA,MACf,cAAc;AAAA,QACZ,MAAM;AAAA,QACN,OAAO;AAAA,UACL,cAAc;AAAA,QAChB;AAAA,MACF;AAAA,IACF;AAAA,EACD;AAAA,EAED,OAAO,SAAS;AAEd,QAAI,QAAQ,MAAM;AAChB,UAAI;AACF,aAAK,eAAe,KAAK,MAAM,mBAAmB,QAAQ,IAAI,CAAC;AAAA,MACjE,SAAS,GAAG;AACVA,sBAAAA,MAAc,MAAA,SAAA,gDAAA,aAAa,CAAC;AAAA,MAC9B;AAAA,IACF;AAAA,EACD;AAAA,EAED,SAAS;AAAA,IACP,SAAS;AACPA,oBAAAA,MAAI,aAAa;AAAA,IAClB;AAAA,IAED,cAAc;AACZ,YAAM,QAAQ,CAAC,OAAO,MAAM,MAAM;AAClC,YAAM,eAAe,MAAM,QAAQ,KAAK,SAAS;AACjD,WAAK,YAAY,OAAO,eAAe,KAAK,MAAM,MAAM;AAAA,IACzD;AAAA,IAED,aAAa;AACX,WAAK,iBAAiB,KAAK,mBAAmB,SAAS,UAAU;AAAA,IAClE;AAAA,IAED,iBAAiB;AACf,WAAK,eAAe,CAAC,KAAK;AAAA,IAC3B;AAAA,IAED,aAAa,MAAM;AACjB,WAAK,YAAY;AACjB,WAAK,eAAe;AAAA,IACrB;AAAA,IAED,YAAY;AACV,YAAM,MAAMA,cAAG,MAAC,oBAAoB;AACpC,UAAI,UAAU;AAAA,QACZ,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,eAAK,gBAAgB,IAAI;AACzBA,wBAAA,MAAA,MAAA,OAAA,gDAAY,SAAS,IAAI,aAAa;AAGtCA,wBAAAA,MAAI,aAAa;AAAA,QAClB;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAc,MAAA,SAAA,gDAAA,SAAS,GAAG;AAC1BA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,WACP;AAAA,QACH;AAAA,OACD;AAAA,IACF;AAAA,IAED,YAAY;AACVA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,UAAU,CAAC,UAAU;AAAA,QACrB,YAAY,CAAC,OAAO;AAAA,QACpB,SAAS,CAAC,QAAQ;AAChB,eAAK,gBAAgB,IAAI,cAAc,CAAC;AAAA,QAC1C;AAAA,OACD;AAAA,IACF;AAAA,IAED,cAAc;AACZ,WAAK,gBAAgB;AAAA,IACtB;AAAA,IAED,eAAe;AACb,UAAI,KAAK,eAAe;AAEtB,cAAM,QAAQ,gBAAgB;AAC9B,cAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AACvC,YAAI,UAAU;AACZ,mBAAS,IAAI,kBAAkB,KAAK,aAAa;AAAA,QACnD;AACAA,sBAAAA,MAAI,aAAa;AAAA,MACnB;AAAA,IACD;AAAA,IAED,cAAc,GAAG;AACfA,oBAAAA,qEAAc,SAAS,CAAC;AACxBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,OACP;AAAA,IACF;AAAA,IAED,gBAAgB;AACdA,oBAAAA,MAAY,MAAA,OAAA,gDAAA,QAAQ;AAAA,IACrB;AAAA,IAED,WAAW,GAAG;AAEZA,oBAAAA,MAAA,MAAA,OAAA,gDAAY,WAAW,CAAC;AAAA,IAC1B;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3PA,GAAG,WAAW,eAAe;"}